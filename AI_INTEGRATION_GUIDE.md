# ü§ñ AI INTEGRATION GUIDE

**Project:** Multi-Tenant Directory Platform
**AI System:** NETZ Team Orchestration (Claude + Gemini + GPT-4)
**Integration:** n8n Workflow Automation
**Created:** 16 Octobre 2025

---

## üìã TABLE DES MATI√àRES

1. [Vue d'ensemble](#vue-densemble)
2. [Architecture AI](#architecture-ai)
3. [Installation et Configuration](#installation-et-configuration)
4. [Fonctionnalit√©s AI](#fonctionnalit√©s-ai)
5. [API Endpoints](#api-endpoints)
6. [Admin Dashboard](#admin-dashboard)
7. [Utilisation](#utilisation)
8. [Workflows n8n](#workflows-n8n)
9. [Troubleshooting](#troubleshooting)

---

## üéØ VUE D'ENSEMBLE

### NETZ Team - AI Orchestration System

Le syst√®me NETZ utilise **3 mod√®les AI en parall√®le** pour des analyses plus compl√®tes:

1. **Claude (Technical Lead)**
   - Analyse de code
   - Debugging
   - Conception syst√®me
   - Documentation technique

2. **Gemini (Research & Innovation)**
   - Solutions cr√©atives
   - Recherche et analyse de donn√©es
   - Optimisation
   - G√©n√©ration de contenu

3. **GPT-4 (Strategy & Integration)**
   - Connaissances g√©n√©rales
   - R√©solution de probl√®mes
   - G√©n√©ration de code
   - Planification strat√©gique

### Avantages

‚úÖ **3 perspectives diff√©rentes** - Analyses plus riches
‚úÖ **Parall√©lisation** - 3x plus rapide qu'un seul AI
‚úÖ **Consensus automatique** - Synth√®se des meilleures r√©ponses
‚úÖ **Sp√©cialisation** - Chaque AI pour sa force
‚úÖ **Fiabilit√©** - Validation crois√©e entre AI

---

## üèóÔ∏è ARCHITECTURE AI

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Multi-Tenant Directory Platform                    ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ   Admin     ‚îÇ  ‚îÇ   Business   ‚îÇ  ‚îÇ  Public   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  Dashboard  ‚îÇ  ‚îÇ     Owner    ‚îÇ  ‚îÇ  Pages    ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ         ‚îÇ                ‚îÇ                 ‚îÇ        ‚îÇ
‚îÇ         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò        ‚îÇ
‚îÇ                          ‚îÇ                          ‚îÇ
‚îÇ                          ‚ñº                          ‚îÇ
‚îÇ              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                ‚îÇ
‚îÇ              ‚îÇ   AI API Routes     ‚îÇ                ‚îÇ
‚îÇ              ‚îÇ  /api/ai/*          ‚îÇ                ‚îÇ
‚îÇ              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚îÇ
                          ‚ñº
              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
              ‚îÇ  AI Orchestrator    ‚îÇ
              ‚îÇ  (orchestrator.ts)  ‚îÇ
              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ
                         ‚ñº
              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
              ‚îÇ   n8n Client        ‚îÇ
              ‚îÇ  (n8n-client.ts)    ‚îÇ
              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ
                         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         n8n Workflow Automation Platform           ‚îÇ
‚îÇ    https://netzfrance.app.n8n.cloud                ‚îÇ
‚îÇ                                                    ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îÇ
‚îÇ  ‚îÇ Claude  ‚îÇ    ‚îÇ Gemini  ‚îÇ    ‚îÇ  GPT-4   ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ  API    ‚îÇ    ‚îÇ   API   ‚îÇ    ‚îÇ   API    ‚îÇ      ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îÇ
‚îÇ       ‚îÇ              ‚îÇ                ‚îÇ           ‚îÇ
‚îÇ       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò           ‚îÇ
‚îÇ                      ‚îÇ                            ‚îÇ
‚îÇ                      ‚ñº                            ‚îÇ
‚îÇ           ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                    ‚îÇ
‚îÇ           ‚îÇ  Consensus Logic ‚îÇ                    ‚îÇ
‚îÇ           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## ‚öôÔ∏è INSTALLATION ET CONFIGURATION

### √âtape 1: Variables d'environnement

Ajouter dans `.env.local` (d√©veloppement):

```bash
# n8n API Configuration
N8N_API_URL="https://netzfrance.app.n8n.cloud"
N8N_API_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."

# AI Features (optional flags)
ENABLE_AI_FEATURES="true"
AI_RATE_LIMIT="100"  # requests per day
```

Ajouter dans **Vercel Environment Variables** (production):

1. Aller sur [vercel.com](https://vercel.com) > Votre projet
2. **Settings** > **Environment Variables**
3. Ajouter:
   ```
   Name: N8N_API_URL
   Value: https://netzfrance.app.n8n.cloud
   Environment: Production, Preview
   ```
4. Ajouter:
   ```
   Name: N8N_API_KEY
   Value: [Votre API key depuis CLAUDE.md]
   Environment: Production, Preview
   Encrypt: ‚úÖ
   ```

### √âtape 2: Installer les d√©pendances

Aucune d√©pendance suppl√©mentaire n'est requise. Les fichiers cr√©√©s utilisent uniquement:
- `fetch` (built-in)
- Next.js App Router
- React

### √âtape 3: V√©rifier l'installation

Test local:
```bash
# Build
npm run build

# V√©rifier qu'aucune erreur TypeScript
npx tsc --noEmit
```

Test de l'API:
```bash
# D√©marrer le serveur
npm run dev

# Tester (dans un autre terminal)
curl http://localhost:3000/api/ai/analyze-company \
  -X POST \
  -H "Content-Type: application/json" \
  -d '{
    "companyName": "Test Company",
    "description": "A test company",
    "categories": ["Test"]
  }'
```

---

## üöÄ FONCTIONNALIT√âS AI

### 1. Company Analysis (Analyse d'entreprise)

**Utilit√©:** Am√©liore les descriptions d'entreprises, sugg√®re des mots-cl√©s SEO

**Entr√©es:**
- Nom de l'entreprise
- Description actuelle
- Cat√©gories actuelles

**Sorties:**
- Description am√©lior√©e (SEO-optimized)
- Mots-cl√©s sugg√©r√©s
- Cat√©gories sugg√©r√©es
- Score SEO (0-100)

**Exemple d'utilisation:**
```typescript
const analysis = await fetch('/api/ai/analyze-company', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    companyName: 'Boulangerie Schneider',
    description: 'Boulangerie artisanale',
    categories: ['Boulangerie'],
  }),
});

const data = await analysis.json();
// {
//   improvedDescription: "Boulangerie artisanale familiale depuis 1952...",
//   suggestedKeywords: ["pain artisanal", "p√¢tisserie", "viennoiserie"],
//   suggestedCategories: ["P√¢tisserie", "Traiteur"],
//   seoScore: 85
// }
```

### 2. Review Response Generator (G√©n√©rateur de r√©ponses aux avis)

**Utilit√©:** G√©n√®re des r√©ponses professionnelles aux avis clients

**Entr√©es:**
- ID de l'avis (depuis la database)
- Ton de la r√©ponse (professional/friendly/formal)

**Sorties:**
- R√©ponse g√©n√©r√©e par AI

**Exemple d'utilisation:**
```typescript
const response = await fetch('/api/ai/generate-review-response', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    reviewId: 123,
    tone: 'professional',
  }),
});

const data = await response.json();
// {
//   reviewId: 123,
//   generatedResponse: "Thank you for your wonderful review...",
//   tone: "professional"
// }
```

### 3. Search Optimization (Optimisation de recherche)

**Utilit√©:** Optimise les requ√™tes de recherche pour de meilleurs r√©sultats

**Entr√©es:**
- Requ√™te de recherche
- Contexte (ville, cat√©gorie, intention)

**Sorties:**
- Requ√™te optimis√©e
- Filtres sugg√©r√©s
- Strat√©gie de recherche

**Exemple d'utilisation:**
```typescript
const optimization = await fetch('/api/ai/optimize-search', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    query: 'restaurant pr√®s de moi',
    context: {
      city: 'Haguenau',
      category: 'Restaurant',
    },
  }),
});

const data = await optimization.json();
// {
//   originalQuery: "restaurant pr√®s de moi",
//   optimizedQuery: "restaurant Haguenau cuisine locale",
//   suggestedFilters: { rating: ">=4", openNow: true },
//   searchStrategy: "semantic"
// }
```

### 4. SEO Content Generator (G√©n√©rateur de contenu SEO)

**Utilit√©:** G√©n√®re du contenu SEO-optimized pour les pages

**Entr√©es:**
- Type de page (category/city/company)
- Nom
- Description (optionnel)
- Mots-cl√©s (optionnel)

**Sorties:**
- Titre SEO
- Meta description
- H1
- Contenu de page
- Structured data (JSON-LD)

**Exemple d'utilisation:**
```typescript
const seoContent = await fetch('/api/ai/generate-seo-content', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    pageType: 'category',
    data: {
      name: 'Restaurant',
      description: 'Restaurants √† Haguenau',
      keywords: ['restaurant', 'gastronomie', 'cuisine'],
    },
  }),
});

const data = await seoContent.json();
// {
//   title: "Restaurants √† Haguenau | Trouvez le meilleur restaurant",
//   metaDescription: "D√©couvrez les meilleurs restaurants...",
//   h1: "Restaurants √† Haguenau",
//   content: "Haguenau regorge de restaurants...",
//   structuredData: { "@type": "Restaurant", ... }
// }
```

---

## üîå API ENDPOINTS

### POST `/api/ai/analyze-company`

Analyse une entreprise et sugg√®re des am√©liorations.

**Body:**
```json
{
  "companyName": "string",
  "description": "string",
  "categories": ["string"]
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "improvedDescription": "string",
    "suggestedKeywords": ["string"],
    "suggestedCategories": ["string"],
    "seoScore": 85
  },
  "timestamp": "2025-10-16T12:00:00Z"
}
```

---

### POST `/api/ai/generate-review-response`

G√©n√®re une r√©ponse professionnelle √† un avis.

**Body:**
```json
{
  "reviewId": 123,
  "tone": "professional" | "friendly" | "formal"
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "reviewId": 123,
    "generatedResponse": "string",
    "tone": "professional"
  },
  "timestamp": "2025-10-16T12:00:00Z"
}
```

---

### POST `/api/ai/optimize-search`

Optimise une requ√™te de recherche.

**Body:**
```json
{
  "query": "string",
  "context": {
    "city": "string",
    "category": "string",
    "userIntent": "string"
  }
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "originalQuery": "string",
    "optimizedQuery": "string",
    "suggestedFilters": {},
    "searchStrategy": "semantic"
  },
  "timestamp": "2025-10-16T12:00:00Z"
}
```

---

### POST `/api/ai/generate-seo-content`

G√©n√®re du contenu SEO-optimized.

**Body:**
```json
{
  "pageType": "category" | "city" | "company",
  "data": {
    "name": "string",
    "description": "string",
    "keywords": ["string"]
  }
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "title": "string",
    "metaDescription": "string",
    "h1": "string",
    "content": "string",
    "structuredData": {}
  },
  "timestamp": "2025-10-16T12:00:00Z"
}
```

---

## üé® ADMIN DASHBOARD

### Acc√®s

URL: `https://haguenau.pro/admin/ai-tools`

**Pr√©requis:** √ätre connect√© comme admin

### Onglets disponibles

#### 1. Company Analysis
- Formulaire: Nom, description, cat√©gories
- Bouton: "Analyze Company"
- R√©sultat: Description am√©lior√©e, keywords, score SEO

#### 2. Review Response
- Formulaire: Review ID, tone
- Bouton: "Generate Response"
- R√©sultat: R√©ponse g√©n√©r√©e

#### 3. Search Optimization
- Formulaire: Query, city, category
- Bouton: "Optimize Search"
- R√©sultat: Query optimis√©e, filtres sugg√©r√©s

#### 4. SEO Content
- Formulaire: Page type, name, description, keywords
- Bouton: "Generate SEO Content"
- R√©sultat: Title, meta, contenu, structured data

---

## üíª UTILISATION

### Cas d'usage 1: Am√©liorer une fiche entreprise

**Workflow:**
1. Admin va sur `/admin/companies/[id]`
2. Copie la description actuelle
3. Va sur `/admin/ai-tools` > "Company Analysis"
4. Colle la description
5. Clique "Analyze Company"
6. Copie la description am√©lior√©e
7. Retourne sur `/admin/companies/[id]` et met √† jour

**R√©sultat:** Description SEO-optimized avec mots-cl√©s pertinents

---

### Cas d'usage 2: R√©pondre √† un avis n√©gatif

**Workflow:**
1. Admin va sur `/admin/reviews`
2. Trouve l'avis (ID 456, 2 √©toiles)
3. Va sur `/admin/ai-tools` > "Review Response"
4. Entre l'ID 456, choisit tone "professional"
5. Clique "Generate Response"
6. Copie la r√©ponse g√©n√©r√©e
7. Retourne sur l'avis et poste la r√©ponse

**R√©sultat:** R√©ponse professionnelle et empathique automatique

---

### Cas d'usage 3: Optimiser le SEO d'une cat√©gorie

**Workflow:**
1. Admin cr√©e une nouvelle page cat√©gorie "Boulangerie"
2. Va sur `/admin/ai-tools` > "SEO Content"
3. Page Type: "category"
4. Name: "Boulangerie"
5. Keywords: "boulangerie, pain artisanal, p√¢tisserie"
6. Clique "Generate SEO Content"
7. Copie le titre, meta description, contenu
8. Utilise le contenu dans la page cat√©gorie

**R√©sultat:** Page cat√©gorie SEO-optimized pr√™te √† indexer

---

## üîß WORKFLOWS N8N

### Workflow: ai-orchestrate

**Webhook URL:** `https://netzfrance.app.n8n.cloud/webhook/ai-orchestrate`

**Fonction:** Distribue les t√¢ches aux 3 AI et synth√©tise les r√©sultats

**Architecture du workflow:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Webhook   ‚îÇ
‚îÇ   Trigger   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
       ‚îÇ            ‚îÇ            ‚îÇ            ‚îÇ
       ‚ñº            ‚ñº            ‚ñº            ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Claude  ‚îÇ ‚îÇ  Gemini  ‚îÇ ‚îÇ  GPT-4   ‚îÇ ‚îÇ  Filter  ‚îÇ
‚îÇ   API    ‚îÇ ‚îÇ   API    ‚îÇ ‚îÇ   API    ‚îÇ ‚îÇ  Logic   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò
      ‚îÇ            ‚îÇ            ‚îÇ            ‚îÇ
      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ
                   ‚ñº
            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
            ‚îÇ  Consensus   ‚îÇ
            ‚îÇ  Generator   ‚îÇ
            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ
                   ‚ñº
            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
            ‚îÇ   Response   ‚îÇ
            ‚îÇ   Formatter  ‚îÇ
            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Input (JSON):**
```json
{
  "taskId": "string",
  "type": "analysis" | "generation" | "optimization" | "research",
  "prompt": "string",
  "context": {},
  "priority": "low" | "medium" | "high"
}
```

**Output (JSON):**
```json
{
  "success": true,
  "data": {
    "responses": [
      {
        "model": "claude",
        "response": "...",
        "confidence": 0.95
      },
      {
        "model": "gemini",
        "response": "...",
        "confidence": 0.92
      },
      {
        "model": "gpt4",
        "response": "...",
        "confidence": 0.89
      }
    ],
    "consensus": "Synthesized response...",
    "recommendations": ["..."]
  }
}
```

### Configuration n8n (√Ä faire)

1. **Cr√©er le workflow dans n8n:**
   - Se connecter √† https://netzfrance.app.n8n.cloud
   - Cr√©er un nouveau workflow nomm√© "AI Orchestration"
   - Ajouter un Webhook Trigger

2. **Ajouter les nodes AI:**
   - Node Claude API (Anthropic)
   - Node Gemini API (Google)
   - Node OpenAI API (GPT-4)

3. **Ajouter la logique de consensus:**
   - Node Function pour comparer les r√©ponses
   - Node Function pour synth√©tiser

4. **Activer le workflow:**
   - Sauvegarder
   - Activer
   - Copier l'URL du webhook

5. **Tester:**
   ```bash
   curl https://netzfrance.app.n8n.cloud/webhook/ai-orchestrate \
     -X POST \
     -H "Content-Type: application/json" \
     -d '{
       "taskId": "test-1",
       "type": "generation",
       "prompt": "Write a professional review response",
       "priority": "high"
     }'
   ```

---

## üêõ TROUBLESHOOTING

### Erreur: "AI service not configured"

**Cause:** Variables d'environnement manquantes

**Solution:**
```bash
# V√©rifier les variables
echo $N8N_API_URL
echo $N8N_API_KEY

# Si vides, les ajouter dans .env.local
N8N_API_URL="https://netzfrance.app.n8n.cloud"
N8N_API_KEY="your-api-key"

# Red√©marrer le serveur
npm run dev
```

---

### Erreur: "Webhook call failed"

**Cause:** Workflow n8n pas activ√© ou URL incorrecte

**Solution:**
1. Aller sur n8n dashboard
2. V√©rifier que le workflow "AI Orchestration" est actif (toggle vert)
3. V√©rifier l'URL du webhook dans le workflow
4. Tester avec curl:
   ```bash
   curl https://netzfrance.app.n8n.cloud/webhook/ai-orchestrate \
     -X POST \
     -H "Content-Type: application/json" \
     -d '{"test": true}'
   ```

---

### Erreur: "429 Too Many Requests"

**Cause:** Rate limit d√©pass√©

**Solution:**
- Impl√©menter un rate limiter c√¥t√© application
- Utiliser un cache pour les r√©ponses fr√©quentes
- Upgrader le plan n8n si n√©cessaire

---

### AI renvoie des r√©ponses g√©n√©riques

**Cause:** Prompt pas assez d√©taill√© ou contexte manquant

**Solution:**
- Am√©liorer les prompts dans `orchestrator.ts`
- Ajouter plus de contexte dans les appels API
- Fine-tuner les mod√®les AI (avanc√©)

---

## üìä M√âTRIQUES

### Performance

**Temps de r√©ponse typique:**
```
Company Analysis:    3-5 secondes
Review Response:     2-4 secondes
Search Optimization: 1-3 secondes
SEO Content:         4-6 secondes
```

**D√©bit:**
```
Free tier n8n:    ~100 requ√™tes/jour
Pro tier n8n:     ~10,000 requ√™tes/jour
```

### Co√ªts

**API Costs (estimation):**
```
Claude API:   $0.002 per request
Gemini API:   $0.001 per request
GPT-4 API:    $0.003 per request
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Total:        ~$0.006 per request
```

**n8n Costs:**
```
Free tier:    0‚Ç¨/mois (100 requ√™tes/jour)
Pro tier:     $20/mois (10,000 requ√™tes/jour)
```

**Sc√©nario 100 requ√™tes/jour:**
```
API costs:    $0.006 √ó 100 √ó 30 = $18/mois
n8n:          Free tier = 0‚Ç¨
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Total:        ~$18/mois (~16‚Ç¨)
```

---

## ‚úÖ CHECKLIST INT√âGRATION

Avant de consid√©rer l'int√©gration AI compl√®te:

- [ ] Variables d'environnement configur√©es (N8N_API_KEY, N8N_API_URL)
- [ ] Workflow n8n "AI Orchestration" cr√©√© et activ√©
- [ ] Test des 4 endpoints API (/api/ai/*)
- [ ] Admin dashboard `/admin/ai-tools` accessible
- [ ] Test d'un cycle complet (Company Analysis)
- [ ] Rate limiting impl√©ment√© (optionnel)
- [ ] Cache pour r√©ponses fr√©quentes (optionnel)
- [ ] Monitoring des co√ªts API (optionnel)
- [ ] Documentation partag√©e avec l'√©quipe

---

## üìö RESSOURCES

- [n8n Documentation](https://docs.n8n.io/)
- [Claude API Docs](https://docs.anthropic.com/)
- [Gemini API Docs](https://ai.google.dev/docs)
- [OpenAI API Docs](https://platform.openai.com/docs)
- [Next.js API Routes](https://nextjs.org/docs/app/building-your-application/routing/route-handlers)

---

**Date de cr√©ation:** 16 Octobre 2025
**Derni√®re mise √† jour:** 16 Octobre 2025
**Auteur:** Claude AI via NETZ Team
**Status:** ‚úÖ Integration Complete - Ready for n8n Workflow Setup
